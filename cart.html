<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="shop.css">
    <link rel="stylesheet" href="cart.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
</head>
<body>
     <div id="header-container"></div>

    <script>
        fetch("header.html")
            .then(res => res.text())
            .then(data => {
                document.getElementById("header-container").innerHTML = data;
            });
    </script>

<!--Banner Cart-->
     <div class="product-shop">
    <div class="shop-image">
      <img src="images/shop-images.png" alt="Shop Background">

      <div class="overlay">
        <h1>Cart</h1>
        <p class="breadcrumb">
          <a href="index.html">Home</a> > Cart
          <a href="shop.html"></a> 
        </p>
      </div>
    </div>
  </div>

<!--Cart Section-->
<section class="cart-container">
    <div class="cart-table">
        <div class="cart-header">
            <div style="text-align: center;">Product</div>
            <div>Price</div>
            <div>Quantity</div>
            <div>Subtotal</div>
        </div>

        <div class="cart-items-container"></div>

    </div>

    <div class="cart-summary">
        <h3>Cart Totals</h3>
        <div class="summary-row">
            <span class="summary-label">Subtotal: </span>
            <span class="value-sub">Rp. 250,000.00</span>
        </div>
        <div class="summary-row">
            <span class="summary-label">Total: </span>
            <span class="value-to">Rp. 250,000.00</span>
        </div>
        <button class="check-btn">Check Out</button>
    </div>
</section>

<!--Contact-->
 <div class="benefit-section">
    <div class="benefit-box">
      <img src="images/trophy.png" alt="High Quality">
      <div>
        <h4>High Quality</h4>
        <p>crafted from top materials</p>
      </div>
    </div>
    <div class="benefit-box">
      <img src="images/guarantee.png" alt="Warranty Protection">
      <div>
        <h4>Warranty Protection</h4>
        <p>Over 2 years</p>
      </div>
    </div>
    <div class="benefit-box">
      <img src="images/shipping.png" alt="Free Shipping">
      <div>
        <h4>Free Shipping</h4>
        <p>Order over 150 $</p>
      </div>
    </div>
    <div class="benefit-box">
      <img src="images/customer-support.png" alt="24 / 7 Support">
      <div>
        <h4>24 / 7 Support</h4>
        <p>Dedicated support</p>
      </div>
    </div>
  </div>
<!--Footer-->
    <div id="footer"></div>

      <script>
        fetch("footer.html")
            .then(res => res.text())
            .then(data => {
                document.getElementById("footer").innerHTML = data;
            });
      </script>

<script>
  function formatPrice(price) {
    return 'Rp. ' + price.toLocaleString('en-US', {minimumFractionDigits: 2});
  }

  function renderCart() {
    const cartContainer = document.querySelector('.cart-items-container');
    const cart = JSON.parse(localStorage.getItem('cart')) || [];

    if (cart.length === 0) {
      cartContainer.innerHTML = '<p>Your cart is empty.</p>';
      document.querySelector('.value-sub').textContent = formatPrice(0);
      document.querySelector('.value-to').textContent = formatPrice(0);
      return;
    }

    let html = '';
    let total = 0;

    cart.forEach((item, index) => {
      let subtotal = item.price * item.quantity;
      total += subtotal;

      html += `
        <div class="cart-item" data-index="${index}">
          <div class="product-info">
            <img src="${item.image}" alt="${item.name}" />
            <div class="product-name">${item.name}</div>
          </div>
          <div>${formatPrice(item.price)}</div>
          <div><input type="number" min="1" value="${item.quantity}" class="quantity-input" data-index="${index}"/></div>
          <div>${formatPrice(subtotal)}</div>
          <div class="remove-icon">
            <img src="images/bin.png" alt="Remove" class="remove-btn" data-index="${index}" style="cursor:pointer; width:20px;"/>
          </div>
        </div>`;
    });

    cartContainer.innerHTML = html;

    document.querySelector('.value-sub').textContent = formatPrice(total);
    document.querySelector('.value-to').textContent = formatPrice(total);

    // Event thay đổi số lượng
    document.querySelectorAll('.quantity-input').forEach(input => {
      input.addEventListener('change', e => {
        let idx = e.target.getAttribute('data-index');
        let value = parseInt(e.target.value);
        if (value < 1) value = 1;
        cart[idx].quantity = value;
        localStorage.setItem('cart', JSON.stringify(cart));
        renderCart();
      });
    });

    // Event xóa sản phẩm
    document.querySelectorAll('.remove-btn').forEach(btn => {
      btn.addEventListener('click', e => {
        let idx = e.target.getAttribute('data-index');
        cart.splice(idx, 1);
        localStorage.setItem('cart', JSON.stringify(cart));
        renderCart();
      });
    });
  }

  document.addEventListener('DOMContentLoaded', () => {
    renderCart();
  });

  function addToCart(name, price, image) {
    // Lấy mảng giỏ hàng hiện tại từ localStorage hoặc tạo mới
    let cart = JSON.parse(localStorage.getItem('cart')) || [];

    // Kiểm tra sản phẩm đã có trong giỏ hàng chưa
    let index = cart.findIndex(item => item.name === name);
    if (index > -1) {
        // Nếu có rồi thì tăng số lượng
        cart[index].quantity += 1;
    } else {
        // Nếu chưa thì thêm mới
        cart.push({name: name, price: price, image: image, quantity: 1});
    }

    // Lưu lại vào localStorage
    localStorage.setItem('cart', JSON.stringify(cart));
}

//link tới trang check out
document.querySelector('.check-btn').addEventListener('click', () => {
  window.location.href = 'checkout.html';  
});

</script>
</body>
</html>